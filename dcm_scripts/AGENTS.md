# AI Agent Operations Manual: DCM Subsystem

**Directive for:** AI Agents with shell execution capabilities
**Purpose:** To standardize the protocol for generating high-quality, context-rich work prompts using the Dynamic Context Management (DCM) Subsystem.

---

## 1. Guiding Principle: Self-Contextualization

Before executing any development or analysis task on a project, the agent must enrich its own context. The user's initial prompt (e.g., "Resolve issue #16") is only the **starting point**.

The objective is to replace that initial prompt with a **rich work prompt**, generated by the DCM subsystem. This new prompt will contain the original task plus the most relevant context extracted from the project's knowledge base (documentation, etc.).

## 2. Standard Operating Procedure (SOP)

The agent must follow these steps sequentially upon receiving a new task.

### **Input:**
The agent receives a primary task. Typically, this will be a GitHub Issue ID or a short task description.

- **Input Example:** `TASK_ID=16`

### **Step 1: Task Deconstruction & Query Formulation**

The agent must transform the primary task into a clear text query for the DCM subsystem.

1.  **If the input is an Issue ID:** Use a CLI tool (like `gh`) to get the issue's title and/or body.
    ```bash
    # Requires 'gh' (GitHub CLI) to be installed and authenticated.
    QUERY=$(gh issue view $TASK_ID --json title --jq .title)
    ```
2.  **If the input is text:** Use the text directly as the query.
    ```bash
    QUERY="Implement CRUD for Users and Nurses"
    ```

### **Step 2: DCM Subsystem Execution**

With the query formulated, the agent must execute the `main.py` script from the DCM to retrieve context and generate the rich prompt.

1.  **Execution Command:**
    ```bash
    # Assumes execution from the project's root directory.
    RICH_PROMPT=$(python dcm_scripts/main.py "$QUERY")
    ```
2.  **Output:** The agent must capture the entire standard output (`stdout`) of this command. This output is the final work prompt.

### **Step 3: Assimilation and Execution**

1.  **Prompt Replacement:** The agent must discard the initial prompt and use the captured `RICH_PROMPT` as its sole source of truth for the task.
2.  **Primary Task Execution:** The agent proceeds with its main function (code generation, analysis, etc.) based exclusively on the content of the `RICH_PROMPT`.

---

## 3. Example Automated Workflow (Shell Script)

This is an example of how an agent could implement the protocol:

```bash
#!/bin/bash

# AI AGENT - SELF-CONTEXTUALIZATION PROTOCOL

# 1. Receive Primary Task (from an orchestrator or user)
TASK_ID="16" # Example: Issue "CRUD for Users and Nurses"

echo "[AGENT] Task received: Resolve issue #$TASK_ID"

# 2. Formulate Query from Task Details
echo "[AGENT] Formulating query from issue details..."

# Assumes 'gh' is available
QUERY=$(gh issue view $TASK_ID --json title --jq .title)

if [ -z "$QUERY" ]; then
    echo "[AGENT] Error: Could not retrieve issue title. Aborting."
    exit 1
fi
echo "[AGENT] Query formulated: '$QUERY'"

# 3. Execute DCM Subsystem to Generate Rich Prompt
echo "[AGENT] Executing DCM to generate work prompt..."

# Assumes the script is run from the project root
RICH_PROMPT=$(python dcm_scripts/main.py "$QUERY")

# 4. Execute Primary Task with the New Prompt
echo "[AGENT] Primary task initiated with the following rich prompt:"
echo "======================================================================"
echo "$RICH_PROMPT"
echo "======================================================================"

# (Here, the agent's internal logic would start its work,
# using the $RICH_PROMPT variable as its main guide)

echo "[AGENT] Process completed."
```

## 4. Benefits of the Protocol

- **Improved Accuracy:** The agent works with project-specific context, not general knowledge.
- **Token Efficiency:** Avoids flooding the context window of the execution model (the one that codes) with irrelevant information.
- **Consistency:** The generated solutions will be better aligned with the project's documented architecture and patterns.
- **Autonomy:** Reduces the need for a human to manually provide context at every step.